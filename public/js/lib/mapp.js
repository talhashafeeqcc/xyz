(()=>{var Nt=Object.create;var q=Object.defineProperty;var Vt=Object.getOwnPropertyDescriptor;var qt=Object.getOwnPropertyNames;var Bt=Object.getPrototypeOf,Zt=Object.prototype.hasOwnProperty;var B=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,o)=>(typeof require!="undefined"?require:t)[o]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var Rt=(e,t)=>{for(var o in t)q(e,o,{get:t[o],enumerable:!0})},Ut=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of qt(t))!Zt.call(e,r)&&r!==o&&q(e,r,{get:()=>t[r],enumerable:!(n=Vt(t,r))||n.enumerable});return e};var Z=(e,t,o)=>(o=e!=null?Nt(Bt(e)):{},Ut(t||!e||!e.__esModule?q(o,"default",{value:e,enumerable:!0}):o,e));var A=class extends Map{set(t,o){return super.set(t,o),o}},C=class extends WeakMap{set(t,o){return super.set(t,o),o}};var Dt=/^(?:area|base|br|col|embed|hr|img|input|keygen|link|menuitem|meta|param|source|track|wbr)$/i,Ht=/<([a-z]+[a-z0-9:._-]*)([^>]*?)(\/?)>/g,Wt=/([^\s\\>"'=]+)\s*=\s*(['"]?)\x01/g,Kt=/[\x01\x02]/g,de=(e,t,o)=>{let n=0;return e.join("").trim().replace(Ht,(r,i,s,c)=>{let f=i+s.replace(Wt,"=$2$1").trimEnd();return c.length&&(f+=o||Dt.test(i)?" /":"></"+i),"<"+f+">"}).replace(Kt,r=>r===""?"<!--"+t+n+++"-->":t+n++)};var on=1,nn=111,Jt=({firstChild:e,lastChild:t})=>{let o=document.createRange();return o.setStartAfter(e),o.setEndAfter(t),o.deleteContents(),e},fe=(e,t)=>e.nodeType===111?1/t<0?t?Jt(e):e.lastChild:t?e.valueOf():e.firstChild:e,me=e=>{let{firstChild:t,lastChild:o}=e;if(t===o)return o||e;let{childNodes:n}=e,r=[...n];return{ELEMENT_NODE:1,nodeType:111,firstChild:t,lastChild:o,valueOf(){return n.length!==r.length&&e.append(...r),e}}};var{isArray:R}=Array,{indexOf:Xt,slice:Qt}=[];var he=!1,G=class{constructor(t,o){he=!0,this._=(...n)=>t(...n,o)}},an=(e,t)=>new G(e,t),ge=e=>t=>{for(let o in t){let n=o==="role"?o:`aria-${o}`,r=t[o];r==null?e.removeAttribute(n):e.setAttribute(n,r)}},U=e=>e==null?e:e.valueOf(),we=(e,t)=>{let o,n=!0,r=document.createAttributeNS(null,t);return i=>{let s=he&&i instanceof G?i._(e,t):U(i);o!==s&&((o=s)==null?n||(e.removeAttributeNode(r),n=!0):(r.value=s,n&&(e.setAttributeNodeNS(r),n=!1)))}},ye=(e,t,o)=>n=>{let r=!!U(n);o!==r&&((o=r)?e.setAttribute(t,""):e.removeAttribute(t))},Yt=({dataset:e})=>t=>{for(let o in t){let n=t[o];n==null?delete e[o]:e[o]=n}},D=(e,t)=>{let o,n,r=t.slice(2);return!(t in e)&&(n=t.toLowerCase())in e&&(r=n.slice(2)),i=>{let s=R(i)?i:[i,!1];o!==s[0]&&(o&&e.removeEventListener(r,o,s[1]),(o=s[0])&&e.addEventListener(r,o,s[1]))}},xe=e=>{let t;return o=>{t!==o&&(t=o,typeof o=="function"?o(e):o.current=e)}},be=(e,t)=>t==="dataset"?Yt(e):o=>{e[t]=o},ve=e=>{let t;return o=>{let n=U(o);t!=n&&(t=n,e.textContent=n??"")}};var Se=(e,t,o,n,r)=>{let i=o.length,s=t.length,c=i,f=0,l=0,a=null;for(;f<s||l<c;)if(s===f){let m=c<i?l?n(o[l-1],-0).nextSibling:n(o[c-l],0):r;for(;l<c;)e.insertBefore(n(o[l++],1),m)}else if(c===l)for(;f<s;)(!a||!a.has(t[f]))&&e.removeChild(n(t[f],-1)),f++;else if(t[f]===o[l])f++,l++;else if(t[s-1]===o[c-1])s--,c--;else if(t[f]===o[c-1]&&o[l]===t[s-1]){let m=n(t[--s],-1).nextSibling;e.insertBefore(n(o[l++],1),n(t[f++],-1).nextSibling),e.insertBefore(n(o[--c],1),m),t[s]=o[c]}else{if(!a){a=new Map;let m=l;for(;m<c;)a.set(o[m],m++)}if(a.has(t[f])){let m=a.get(t[f]);if(l<m&&m<c){let x=f,b=1;for(;++x<s&&x<c&&a.get(t[x])===m+b;)b++;if(b>m-l){let v=n(t[f],0);for(;l<m;)e.insertBefore(n(o[l++],1),v)}else e.replaceChild(n(o[l++],1),n(t[f++],-1))}else f++}else e.removeChild(n(t[f++],-1))}return o};var{isArray:j,prototype:eo}=Array,{indexOf:H}=eo,{createDocumentFragment:to,createElement:oo,createElementNS:no,createTextNode:W,createTreeWalker:K,importNode:J}=new Proxy(document,{get:(e,t)=>e[t].bind(e)}),ro=e=>{let t=oo("template");return t.innerHTML=e,t.content},_,io=e=>{_||(_=no("http://www.w3.org/2000/svg","svg")),_.innerHTML=e;let t=to();return t.append(..._.childNodes),t},ke=(e,t)=>t?io(e):ro(e);var so=({childNodes:e},t)=>e[t],$=(e,t,o)=>Se(e.parentNode,t,o,fe,e),lo=e=>{let t,o,n=[],r=i=>{switch(typeof i){case"string":case"number":case"boolean":t!==i&&(t=i,o||(o=W("")),o.data=i,n=$(e,n,[o]));break;case"object":case"undefined":if(i==null){t!=i&&(t=i,n=$(e,n,[]));break}if(j(i)){t=i,i.length===0?n=$(e,n,[]):typeof i[0]=="object"?n=$(e,n,i):r(String(i));break}if(t!==i)if("ELEMENT_NODE"in i)t=i,n=$(e,n,i.nodeType===11?[...i.childNodes]:[i]);else{let s=i.valueOf();s!==i&&r(s)}break;case"function":r(i(e));break}};return r},ao=(e,t)=>{switch(t[0]){case"?":return ye(e,t.slice(1),!1);case".":return be(e,t.slice(1));case"@":return D(e,"on"+t.slice(1));case"o":if(t[1]==="n")return D(e,t)}switch(t){case"ref":return xe(e);case"aria":return ge(e)}return we(e,t)};function Ee(e){let{type:t,path:o}=e,n=o.reduceRight(so,this);return t==="node"?lo(n):t==="attr"?ao(n,e.name):ve(n)}var X=e=>{let t=[],{parentNode:o}=e;for(;o;)t.push(H.call(o.childNodes,e)),e=o,{parentNode:o}=e;return t},F="is\xB5",Me=new C,co=/^(?:textarea|script|style|title|plaintext|xmp)$/,L=()=>({stack:[],entry:null,wire:null}),po=(e,t)=>{let{content:o,updates:n}=fo(e,t);return{type:e,template:t,content:o,updates:n,wire:null}},uo=(e,t)=>{let o=e==="svg",n=de(t,F,o),r=ke(n,o),i=K(r,129),s=[],c=t.length-1,f=0,l=`${F}${f}`;for(;f<c;){let a=i.nextNode();if(!a)throw`bad template: ${n}`;if(a.nodeType===8)a.data===l&&(s.push({type:"node",path:X(a)}),l=`${F}${++f}`);else{for(;a.hasAttribute(l);)s.push({type:"attr",path:X(a),name:a.getAttribute(l)}),a.removeAttribute(l),l=`${F}${++f}`;co.test(a.localName)&&a.textContent.trim()===`<!--${l}-->`&&(a.textContent="",s.push({type:"text",path:X(a)}),l=`${F}${++f}`)}}return{content:r,nodes:s}},fo=(e,t)=>{let{content:o,nodes:n}=Me.get(t)||Me.set(t,uo(e,t)),r=J(o,!0),i=n.map(Ee,r);return{content:r,updates:i}},O=(e,{type:t,template:o,values:n})=>{let r=Ce(e,n),{entry:i}=e;(!i||i.template!==o||i.type!==t)&&(e.entry=i=po(t,o));let{content:s,updates:c,wire:f}=i;for(let l=0;l<r;l++)c[l](n[l]);return f||(i.wire=me(s))},Ce=({stack:e},t)=>{let{length:o}=t;for(let n=0;n<o;n++){let r=t[n];r instanceof E?t[n]=O(e[n]||(e[n]=L()),r):j(r)?Ce(e[n]||(e[n]=L()),r):e[n]=null}return o<e.length&&e.splice(o),o},E=class{constructor(t,o,n){this.type=t,this.template=o,this.values=n}};var Le=e=>{let t=new C,o=n=>(r,...i)=>O(n,{type:e,template:r,values:i});return Object.assign((n,...r)=>new E(e,n,r),{for(n,r){let i=t.get(n)||t.set(n,new A);return i.get(r)||i.set(r,o(L()))},node:(n,...r)=>O(L(),new E(e,n,r)).valueOf()})},je=new C,Q=(e,t)=>{let o=typeof t=="function"?t():t,n=je.get(e)||je.set(e,L()),r=o instanceof E?O(n,o):o;return r!==n.wire&&(n.wire=r,e.replaceChildren(r.valueOf())),e},Y=Le("html"),y=Le("svg");function N(e,t=new WeakMap){if(e===null||typeof e!="object"||typeof e=="function"||e instanceof HTMLElement)return e;let o=Array.isArray(e)?[]:{};if(t.get(e))return t.get(e);t.set(e,o);for(let n in e)o[n]=N(e[n],t);return o}var ee,$e;async function mo(){ee||(ee=new Promise(async e=>{import("https://cdn.skypack.dev/convert@4").then(t=>e($e=t.convert))})),await ee}var Fe=async(e,t)=>(await mo(),e=parseFloat(e),t.units&&t.convertTo&&(e=$e(e,t.units).to(t.convertTo)),e=e.toFixed(t.decimals||0),e=e.toLocaleString(t.locale||"en-GB"),`${t.prefix||""}${e}${t.suffix||""}`);function Oe(e){let t=document.body.appendChild(mapp.utils.html.node`
    <textarea style="visibility=none;">`);t.value=e,t.select(),document.execCommand("copy"),t.remove()}function Pe(e){if(e.indexOf(";base64,")==-1){let i=e.split(","),s=i[0].split(":")[1],c=i[1];return new Blob([c],{type:s})}let t=e.split(";base64,"),o=t[0].split(":")[1],n=window.atob(t[1]),r=new Uint8Array(n.length);for(let i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return new Blob([r],{type:o})}var Fn=5,Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",ho=[62,-1,-1,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,63,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],ze=1,go=0,On=1,Pn=2,Tn=3,zn=6,In=7,h=typeof BigInt<"u"?BigInt:Number;function Ie(e){let t=yo(e),o=xo(t[0],t[1]),n=10**o.precision,r=10**o.thirdDimPrecision,{thirdDim:i}=o,s=0,c=0,f=0,l=[],a=2;for(;a<t.length;){let m=te(t[a])/n,x=te(t[a+1])/n;s+=m,c+=x,i?(f+=te(t[a+2])/r,l.push([s,c,f]),a+=3):(l.push([s,c]),a+=2)}if(a!==t.length)throw new Error("Invalid encoding. Premature ending reached");return{...o,polyline:l}}function wo(e){let t=e.charCodeAt(0);return ho[t-45]}function yo(e){let t=h(0),o=h(0),n=[];if(e.split("").forEach(r=>{let i=h(wo(r));t|=(i&h(31))<<o,(i&h(32))===h(0)?(n.push(t),t=h(0),o=h(0)):o+=h(5)}),o>0)throw new Error("Invalid encoding");return n}function xo(e,t){if(+e.toString()!==ze)throw new Error("Invalid format version");let o=+t.toString(),n=o&15,r=o>>4&7,i=o>>7&15;return{precision:n,thirdDim:r,thirdDimPrecision:i}}function te(e){let t=e;return t&h(1)&&(t=~t),t>>=h(1),+t.toString()}function An({precision:e=5,thirdDim:t=go,thirdDimPrecision:o=0,polyline:n}){let r=10**e,i=10**o,s=bo(e,t,o),c=[],f=h(0),l=h(0),a=h(0);return n.forEach(m=>{let x=h(Math.round(m[0]*r));c.push(ne(x-f)),f=x;let b=h(Math.round(m[1]*r));if(c.push(ne(b-l)),l=b,t){let v=h(Math.round(m[2]*i));c.push(ne(v-a)),a=v}}),[...s,...c].join("")}function bo(e,t,o){if(e<0||e>15)throw new Error("precision out of range. Should be between 0 and 15");if(o<0||o>15)throw new Error("thirdDimPrecision out of range. Should be between 0 and 15");if(t<0||t>7||t===4||t===5)throw new Error("thirdDim should be between 0, 1, 2, 3, 6 or 7");let n=o<<7|t<<4|e;return oe(ze)+oe(n)}function oe(e){let t="",o=h(e);for(;o>31;){let n=o&h(31)|h(32);t+=Te[n],o>>=h(5)}return t+Te[o]}function ne(e){let t=h(e),o=t<0;return t<<=h(1),o&&(t=~t),oe(t)}var Ae={decodeIsoline:Ie,geometryFunction:vo};function vo(e,t,o){let n=new ol.geom.Circle(e,o.range*1e3),r=ol.proj.transform(e,`EPSG:${t.mapview.srid}`,"EPSG:4326"),i={"range[type]":o["range[type]"],"range[values]":o.range*60,transportMode:o.transportMode,optimizeFor:o.optimizeFor,origin:`${r[1]},${r[0]}`};return o.lat=r[1],o.lon=r[0],o.dateISO&&(i[o.reverseDirection&&"arrivalTime"||"departureTime"]=new Date(o.dateISO).toISOString()),mapp.utils.xhr(`${t.mapview.host}/api/proxy?url=${encodeURIComponent(`https://isoline.router.hereapi.com/v8/isolines?${mapp.utils.paramString(i)}&{HERE}`)}`).then(s=>{if(!s.isolines)return console.log(s),alert("Query failed.");let c=Ie(s.isolines[0].polygons[0].outer);c.polyline.forEach(l=>l.reverse()),c.polyline.push(c.polyline[0]);let f=t.mapview.interaction.format.readFeature({type:"Feature",geometry:{type:"Polygon",coordinates:[c.polyline]}},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+t.mapview.srid});t.mapview.interaction.source.clear(),t.mapview.interaction.source.addFeature(f)}),n}var Ge=(e,t)=>isNaN(t)?e:e.length===7?e+(t&&parseInt(t*255).toString(16)||"00"):e.length===4?e+parseInt(t*15).toString(16):e;var _e=e=>{if(!!Array.isArray(e))return new Promise(t=>{let o=e.map(n=>new Promise((r,i)=>import(n).then(s=>{r(s)}).catch(s=>{console.error(s),i()})));Promise.all(o).then(n=>{t(n)}).catch(t)})};var Ne=(e,t,o)=>{let n=new ol.geom.Circle(e,o.minutes*1e3),r=ol.proj.transform(e,`EPSG:${t.mapview.srid}`,"EPSG:4326");return mapp.utils.xhr(`https://api.mapbox.com/isochrone/v1/mapbox/${o.profile}/${r.join(",")}?${mapp.utils.paramString({contours_minutes:o.minutes,polygons:!0,access_token:o.access_token})}`).then(i=>{if(!i.features)return;let s=t.mapview.interaction.format.readFeature({type:"Feature",geometry:i.features[0].geometry},{dataProjection:"EPSG:4326",featureProjection:"EPSG:"+t.mapview.srid});t.mapview.interaction.source.clear(),t.mapview.interaction.source.addFeature(s)}),n};function Ve(e,t={}){navigator.geolocation.getCurrentPosition(e,o=>console.error(o),t)}function P(e,...t){if(!t.length)return e;let o=t.shift();if(re(e)&&re(o))for(let n in o)re(o[n])?(e[n]||Object.assign(e,{[n]:{}}),P(e[n],o[n])):Object.assign(e,{[n]:o[n]});return P(e,...t)}function re(e){return e&&typeof e=="object"&&!Array.isArray(e)}var qe=e=>Object.entries(e).filter(t=>t[1]===0||!!t[1]).filter(t=>t[1]!=="{}").filter(t=>typeof t[1]!="object"||t[1].length||Object.values(t[1]).some(o=>typeof o=="object"&&Object.keys(o).length)).map(t=>(typeof t[1]=="object"&&!Array.isArray(t[1])&&(t[1]=JSON.stringify(t[1])),encodeURI(`${t[0]}=${t[1]}`))).join("&");var Be=e=>new Promise((t,o)=>{Promise.all(e).then(t).catch(n=>{console.error(n),o(n)})});var Ze=e=>{e.queryparams=e.queryparams||{},e.queryparams.layer=e.queryparams.layer||e.viewport,Array.isArray(e.queryparams.fieldValues)&&e.location&&e.queryparams.fieldValues.forEach(n=>{let r=e.location.infoj.find(i=>i.field===n);e.queryparams[n]=r.value});let t=e.viewport&&e.layer.mapview.getBounds(),o=e.queryparams.center&&ol.proj.transform(e.layer.mapview.Map.getView().getCenter(),`EPSG:${e.layer.mapview.srid}`,"EPSG:4326");return Object.assign({},e.queryparams,{template:encodeURIComponent(e.query),filter:e.queryparams.filter&&e.layer.filter?.current,locale:e.queryparams.layer&&e.layer.mapview.locale.key,layer:e.queryparams.layer&&e.layer.key,id:e.queryparams?.id&&e.location?.id,lat:o&&o[1],lng:o&&o[0],z:e.queryparams?.z&&e.layer.mapview.Map.getView().getZoom(),viewport:t&&[t.west,t.south,t.east,t.north,e.layer.mapview.srid],fieldValues:void 0})};var Ue=(e,t)=>e?(Array.isArray(e.icon?.layers)&&(e=e.icon.layers.map(n=>{let r=mapp.utils.clone(e);return Object.assign(r.icon,n),r})),Array.isArray(e)&&e.map(n=>Re(n,t))||Re(e,t)):void 0;function Re(e,t){if(e.fill=e.fillColor&&new ol.style.Fill({color:mapp.utils.hexa(e.fillColor,e.fillOpacity)}),e.stroke=e.strokeColor&&new ol.style.Stroke({color:mapp.utils.hexa(e.strokeColor,e.strokeOpacity),width:parseFloat(e.strokeWidth||1)}),e.icon){Object.assign(e.icon,t&&t.getProperties());let o=e.icon.scale||1;o*=e.icon.clusterScale||1,o*=e.icon.zoomInScale||1,o*=e.icon.zoomOutScale||1,o*=e.icon.highlightScale||1,e.icon.url=e.icon.url||e.icon.svg||mapp.utils.svgSymbols[e.icon.type](e.icon,t),e.image=new ol.style.Icon({src:e.icon.url,crossOrigin:"anonymous",scale:o,anchor:e.icon.anchor||[.5,.5]})}return typeof e.label?.text<"u"&&(e.text=new ol.style.Text({font:e.label.font||"12px sans-serif",text:String(e.label.text),overflow:e.label.overflow,stroke:e.label.strokeColor&&new ol.style.Stroke({color:e.label.strokeColor,width:e.label.strokeWidth||1}),fill:new ol.style.Fill({color:e.label.fillColor||"#000"})})),new ol.style.Style(e)}var se={};Rt(se,{circle:()=>Fo,diamond:()=>Co,dot:()=>So,markerColor:()=>$o,markerLetter:()=>jo,semiCircle:()=>Lo,square:()=>Mo,target:()=>ko,template:()=>Oo,triangle:()=>Eo});var S=new XMLSerializer,ie={dot:new Map};function So(e){let t=Object.values({fillColor:e.fillColor}).reduce((n,r)=>n+r);if(ie.dot.has(t))return ie.dot.get(t);let o=y.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 r=10 fill='#333'></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#fff"}></circle>`;return o=`data:image/svg+xml,${encodeURIComponent(S.serializeToString(o))}`,ie.dot.set(t,o),o}function ko(e){let t=y.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=13 cy=13 fill='#333' r=10 opacity=0.4></circle>
      <circle cx=12 cy=12 r=10 fill=${e.fillColor||"#FFF"}>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(y.node`<circle cx=12 cy=12 r=${parseFloat(o[0])*10} fill=${o[1]}>`)}),`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Eo(e){let t=y.node`
    <svg width=24 height=24 viewBox='${"0 0 24 24"}' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        points="12,4.68 2,22 22,22" 
        fill="#333" stroke="#333" opacity=0.4 stroke-opacity=0.4 stroke-width=3
        stroke-linejoin="round"/>`;return t.appendChild(y.node`
    <polygon
      fill=${e.fillColor||"#FFF"} stroke=${e.fillColor||"#FFF"} stroke-width=2
      points="12,4.68 2,22 22,22"  stroke-linejoin="round"/>`),e.layers&&Object.entries(e.layers).forEach(o=>{function n(s,c){return 12+(s-12)*c}function r(s,c){return 16+(s-16)*c}let i=`${n(12,o[0])},${r(4.68,o[0])} ${n(2,o[0])}, ${r(22,o[0])} ${n(22,o[0])}, ${r(22,o[0])}`;t.appendChild(y.node`
      <polygon
        points="${i}"
        fill=${o[1]}
        stroke=${o[1]||"#FFF"}
        stroke-width=1
        stroke-linejoin="round"/>`)}),`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Mo(e){let t=y.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <rect fill='#333' opacity=0.3 width=20 height=20 x=2 y=2 rx=1></rect>
      <rect fill=${e.fillColor||"#FFF"} width=20 height=20 x=0 y=0 rx=1></rect>`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(y.node`
      <rect fill=${o[1]}
        width=${parseFloat(o[0])*20}
        height=${parseFloat(o[0])*20}
        x=${10*(1-parseFloat(o[0]))}
        y=${10*(1-parseFloat(o[0]))} rx=${parseFloat(o[0])}></rect>`)}),`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Co(e){let t=y.node`
    <svg width=24 height=24 viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
      <polygon
        fill='#333'
        opacity=0.3
        points="12 0, 24 12, 12 24, 0 12"></polygon>
      <polygon
        fill=${e.fillColor||"#FFF"}
        points="12 0, 24 12, 12 24, 0 12"></polygon>`;function o(n,r){return 12+(n-12)*r}return e.layers&&Object.entries(e.layers).forEach(n=>{let r=`${o(12,n[0])} ${o(0,n[0])},${o(24,n[0])} ${o(12,n[0])},${o(12,n[0])} ${o(24,n[0])}, ${o(0,n[0])} ${o(12,n[0])}`;t.appendChild(y.node`
      <polygon
        fill=${n[1]||"#FFF"}
        points="${r}"></polygon>`)}),`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Lo(e){let t=y.node`
    <svg width=30 height=30 viewBox='0 0 20 24' xmlns='http://www.w3.org/2000/svg'>
      <defs>
        <clipPath id="cut-off-shade">
          <rect x="0" y="0" width="24" height="11"/>
        </clipPath>
        <clipPath id="cut-off">
          <rect x="0" y="0" width="24" height="10"/>
        </clipPath>
      </defs>
      <circle cx="11" cy="10" r="10" clip-path="url(#cut-off-shade)" fill="#333" opacity=0.4></circle>
      <circle cx=10 cy=10 r=10 fill=${e.fillColor||"#FFF"} clip-path="url(#cut-off-shade)">`;return e.layers&&Object.entries(e.layers).forEach(o=>{t.appendChild(y.node`
      <circle cx=10 cy=10 r=${parseFloat(o[0])*10} fill=${o[1]} clip-path="url(#cut-off-shade)">`)}),`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function jo(e){let t=y.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path fill="${e.color}"
        d="M 12 1.969 C 7.878 1.969 4.813 5.239 4.813 9.328 C 4.813 10.554 5.222 12.189 6.244 14.028 C 8.289 17.504 12 22 12 22 C 12 22 16.055 17.504 18.099 14.028 C 19.122 12.189 19.341 10.963 19.341 9.328 C 19.341 5.239 16.054 1.969 12 1.969 Z"/>
      <circle cx="12.17192400568182" cy="8.918683238636365" r="5.109789772727275" fill="rgb(255, 255, 255)"/>
      <text x="12" y="12" style="text-anchor: middle; font-weight: 600; font-size: 9px; font-family: sans-serif; fill: rgb(85, 85, 85);">
      ${e.letter}`;return`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function $o(e){let t=y.node`
    <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path style="opacity: 0.5;" fill="${e.colorMarker}"
        d="M 10.797 1.238 C 6.308 1.238 2.716 4.83 2.716 9.32 C 2.716 11.116 3.165 12.463 4.287 14.483 C 6.532 18.3 9.952 23.234 9.952 23.234 C 9.952 23.234 15.063 18.3 17.308 14.483 C 18.43 12.463 18.879 11.116 18.879 9.32 C 18.879 4.83 15.287 1.238 10.797 1.238 Z"/>
      <path fill="${e.colorMarker}"
        d="M 10 1.238 C 5.51 1.238 2.144 4.83 2.144 9.32 C 2.144 10.667 2.593 12.463 3.716 14.483 C 5.961 18.3 10 23.238 10 23.238 C 10 23.238 14.491 18.3 16.736 14.483 C 17.859 12.463 18.1 11.116 18.1 9.32 C 18.1 4.83 14.49 1.238 10 1.238 Z"/>
      <circle cx="10.226" cy="8.871" r="5.612" opacity="0.8" fill="rgb(255, 255, 255)"/>
      <circle cx="10.226" cy="8.871" r="2.806" opacity="0.8" fill="${e.colorDot}"/>`;return`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Fo(e){let t=y.node`
    <svg width=24 height=24 viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'>
      <circle cx=16 cy=16 r=10
        stroke="${e.strokeColor||"#333"}"
        stroke-width="${e.strokeWidth||1}"
        fill="#ffffff33">`;return`data:image/svg+xml,${encodeURIComponent(S.serializeToString(t))}`}function Oo(e,t){let o=Object.assign({},e.params,t.getProperties()),n=e.template;for(let r of Object.entries(o))n=n.replaceAll(r[0],r[1]);return`data:image/svg+xml,${encodeURIComponent(n)}`}var De=e=>{let t=e.getGeometry(),o=t.getCoordinates(),n=t.getType();if(!!o){if(n==="Point")return new ol.geom.Point(t.getCoordinates());if(n==="LineString")return new ol.geom.MultiPoint(t.getCoordinates());var r=n==="MultiPolygon"&&t.getCoordinates()[0]||t.getCoordinates(),i=new ol.geom.MultiPoint(r[0]);return i}};var le=new Map,He=e=>new Promise((t,o)=>{if(!e)return o();if(e=typeof e=="string"?{url:e}:e,e.cache&&le.has(e))return t(le.get(e));let n=new XMLHttpRequest;n.open(e.method||"GET",e.url);let r={"Content-Type":"application/json"};Object.assign(r,e.requestHeader||{}),Object.entries(r).forEach(i=>n.setRequestHeader(...i)),n.responseType=e.responseType||"json",n.onload=i=>{if(i.target.status>=300){o(new Error(i.target.status));return}e.cache&&le.set(e,i.target.response),t(i.target.response)},n.send(e.body)});var Po=(e,t)=>e.size===t.size&&[...e].every(o=>t.has(o)),To=(...e)=>t=>e.reduce((o,n)=>n(o),t),zo=async()=>await new Promise(async e=>{let t=document.createElement("script");t.type="application/javascript",t.src="https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js",t.onload=e,document.head.append(t)}),We={render:Q,html:Y,svg:y,convert:Fe,areSetsEqual:Po,clone:N,compose:To,copyToClipboard:Oe,dataURLtoBlob:Pe,getCurrentPosition:Ve,here:Ae,hexa:Ge,loadPlugins:_e,mapboxGeometryFunction:Ne,merge:P,olScript:zo,paramString:qe,promiseAll:Be,queryParams:Ze,style:Ue,svgSymbols:se,verticeGeoms:De,xhr:He};var g={current:{layers:[],locations:[]},set:Ao,parse:Io,remove:Ke,removeAll:Go,push:_o,filter:No},V=g;function Io(){window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(e,t,o)=>{if(o==="false"){g.current[t]=!1;return}if(o==="true"){g.current[t]=!0;return}if(t==="locations"||t==="layers"){g.current[t]=decodeURI(o).split(",");return}g.current[t]=o.includes(",")&&decodeURI(o).split(",")||o}),g.current.token&&(window.history.replaceState({},document.title,window.location.href.replace(new RegExp(`token=${g.current.token}`),"")),delete g.current.token)}function Ao(e){Object.assign(g.current,e),T()}function Ke(e){Array.isArray(g.current[e])?g.current[e].length=0:delete g.current[e],T()}function Go(){Object.keys(g.current).forEach(e=>Ke(e)),T()}function _o(e,t){g.current[e]?g.current[e].indexOf(t)<0&&g.current[e].push(t):g.current[e]=[t],T()}function No(e,t){g.current[e]=g.current[e].filter(o=>o!==t),T()}function T(){try{window.history.pushState({},document.title,`?${mapp.utils.paramString(g.current)}`)}catch(e){console.log(e)}}var Je={save:"Save",cancel:"Cancel",confirm_delete:"Are you sure you want to delete this feature? This cannot be undone.",invalid_geometry:"Invalid geometry",no_results:"No results for this search"};var Xe={save:"Speichern",cancel:"Abbrechen",invalid_geometry:"Ung\xFCltige Geometrie",confirm_delete:"Best\xE4tigung des L\xF6schvorgang"};var Qe={save:"Enregister",cancel:"Annuler",no_results:"Aucun resultat pour cette recherche"};var Ye={save:"Zapisz",cancel:"Anuluj",no_results:"Nic nie znaleziono"};var et={save:"\u4FDD\u5B58",cancel:"\u30AD\u30E3\u30F3\u30BB\u30EB",no_results:"\u7D50\u679C\u306A\u3057"};var tt={save:"\uC800\uC7A5",cancel:"\uCDE8\uC18C",no_results:"\uAC80\uC0C9\uACB0\uACFC \uC5C6\uC74C"};var ot={save:"\u4FDD\u5B58",cancel:"\u53D6\u6D88",no_results:"\u672A\u627E\u5230\u76F8\u5173\u5730\u70B9"};var nt={en:Je,de:Xe,fr:Qe,pl:Ye,ja:et,ko:tt,zh:ot};var ae,z=null;async function Vo(){return z?new z.Map(...arguments):(ae||(ae=new Promise(async e=>{if(window.maplibregl){z=window.maplibregl,e();return}Promise.all([import("https://cdn.skypack.dev/pin/maplibre-gl@v1.15.3-OFxGDsJNZ70P0Qa7CzNE/mode=imports,min/optimized/maplibre-gl.js")]).then(t=>{z=t[0],e()}).catch(t=>{console.error(t.message),alert("Failed to load MaplibreGL library. Please reload the browser.")})})),await ae,new z.Map(...arguments))}var rt=async e=>{let t=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=await Vo({container:t,style:e.mbStyle,accessToken:e.accessToken,attributionControl:!1,boxZoom:!1,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1,preserveDrawingBuffer:e.preserveDrawingBuffer}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:o=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(o.viewState.center),zoom:o.viewState.zoom-1,bearing:-o.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var ce,I=null;async function qo(){return I?new I.Map(...arguments):(ce||(ce=new Promise(async e=>{if(window.mapboxgl){I=window.mapboxgl,e();return}Promise.all([import("https://cdn.skypack.dev/pin/mapbox-gl@v2.8.2-2X0QssQ9YYqMIe57RkqH/mode=imports,min/optimized/mapbox-gl.js")]).then(t=>{I=t[0],e()}).catch(t=>{console.error(t.message),alert("Failed to load MapboxGL library. Please reload the browser.")})})),await ce,new I.Map(...arguments))}var it=async e=>{let t=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%;">`;e.mbMap=await qo({accessToken:e.accessToken,container:t,style:e.mbStyle}),e.L=new ol.layer.Layer({zIndex:e.zIndex||0,render:o=>{if(!!e.display)return e.mbMap.jumpTo({center:ol.proj.toLonLat(o.viewState.center),zoom:o.viewState.zoom-1,bearing:-o.viewState.rotation*180/Math.PI,animate:!1}),e.mbMap._frame&&(e.mbMap._frame.cancel(),e.mbMap._frame=null),e.mbMap._render(),e.resized||(e.resized=!0,window.setTimeout(()=>e.mbMap.resize(),500)),e.mbMap.getContainer()}})};var st=e=>{let t=e.proxy&&`${e.mapview.host}/api/proxy?url=${e.URI}`||e.URI,o=new ol.source.OSM({url:decodeURIComponent(t),opaque:!1,transition:0});e.L=new ol.layer.Tile({source:o,layer:e,zIndex:e.style.zIndex||0})};var lt=e=>{e.reload=()=>{t.refresh()},e.clones=new Set,e.snapSource=new ol.source.VectorTile({format:new ol.format.MVT({featureClass:ol.Feature}),transition:0,cacheSize:0,tileUrlFunction:o});let t=new ol.source.VectorTile({format:new ol.format.MVT,transition:0,cacheSize:0,tileUrlFunction:o});function o(n){let r=e.tableCurrent();return(!r||!e.display)&&!e.clones?.size?t.clear():`${e.mapview.host}/api/layer/mvt/${n[0]}/${n[1]}/${n[2]}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,srid:e.mapview.srid,table:r,filter:e.filter&&e.filter.current})}e.L=new ol.layer.VectorTile({key:e.key,source:t,renderBuffer:200,zIndex:e.style.zIndex||1,style:mapp.layer.Style(e)})};var at=e=>{e.highlight=!0,e.reload=t;function t(){if(!e.display)return;e.mapview.popup(null),e.xhr&&e.xhr.abort();let o=e.tableCurrent();if(!o){e.L.getSource().clear();return}let n=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/cluster/${e.mapview.Map.getView().getZoom()}?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:o,kmeans:e.cluster_kmeans||void 0,dbscan:e.cluster_dbscan||void 0,resolution:e.cluster_resolution||void 0,hexgrid:e.cluster_hexgrid,theme:e.style.theme?.type,size:e.style.theme?.size,cat:e.style.theme?.fieldfx||e.style.theme?.field,cat_template:e.style.theme?.cat_template,aggregate:e.style.theme?.aggregate,label:e.style.label?.field,label_template:e.style.label?.template,filter:e.filter?.current,viewport:[n[0],n[1],n[2],n[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=r=>{if(r.target.status!==200)return;e.max_size=r.target.response.reduce((s,c)=>Math.max(s,c.properties.size||c.properties.count),0);let i=r.target.response.map((s,c)=>new ol.Feature(Object.assign({id:`_${c+1}`,geometry:new ol.geom.Point(e.srid==4326&&ol.proj.fromLonLat([s.geometry.x,s.geometry.y])||[s.geometry.x,s.geometry.y])},s.properties)));e.renderCount=0,e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:i}))},e.xhr.send()}e.L=new ol.layer.Vector({key:e.key,layer:e,zIndex:e.style.zIndex||10,style:mapp.layer.Style(e)}),e.debug&&(e.L.on("prerender",()=>{console.log(`${e.key} - prerender ${e.renderCount++}`)}),e.L.on("postrender",()=>{console.log(`${e.key} - postrender ${e.renderCount++}`)})),e.mapview.Map.getTargetElement().addEventListener("changeEnd",t)};var ct=e=>{e.format=new ol.format.GeoJSON,e.reload=t;function t(){mapp.utils.xhr(`${e.mapview.host}/api/layer/geojson?${mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:e.table,filter:e.filter&&e.filter.current})}`).then(o=>{if(o===null)return;let n=o.map(i=>new ol.Feature({id:i.id,geometry:e.format.readGeometry(i.geometry,{dataProjection:"EPSG:"+e.srid,featureProjection:"EPSG:"+e.mapview.srid}),properties:i.properties})),r=new ol.source.Vector({features:n});e.clusterSource&&(r=new ol.source.Cluster({distance:e.clusterSource.distance||50,source:r})),e.L.setSource(r)})}e.L=new ol.layer[e.vectorImage&&"VectorImage"||"Vector"]({key:e.key,zIndex:e.zIndex||1,style:e.styleFunction||mapp.layer.Style(e)})};var pt=e=>{e.grid_size=Object.values(e.grid_fields)[0],e.grid_color=Object.values(e.grid_fields)[1],e.grid_ratio=!1,e.reload=t;function t(){if(!e.display)return;e.xhr&&e.xhr.abort();let o=e.tableCurrent();if(!o){e.L.getSource().clear();return}let n=ol.proj.transformExtent(e.mapview.Map.getView().calculateExtent(e.mapview.Map.getSize()),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`);e.xhr=new XMLHttpRequest,e.xhr.open("GET",`${e.mapview.host}/api/layer/grid?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.key,table:o,size:e.grid_size,color:e.grid_color,viewport:[n[0],n[1],n[2],n[3]]})),e.xhr.setRequestHeader("Content-Type","application/json"),e.xhr.responseType="json",e.xhr.onload=r=>{if(r.target.status!==200)return;let i=r.target.response;e.sizeAvg=0,e.colorAvg=0;let s=i.map(a=>{if(parseFloat(a[2])>0)return a[2]=isNaN(a[2])?a[2]:parseFloat(a[2]),a[3]=isNaN(a[3])?a[3]:parseFloat(a[3]),e.grid_ratio&&a[3]>0&&(a[3]/=a[2]),e.sizeAvg+=parseFloat(a[2]),e.colorAvg+=isNaN(a[3])?0:parseFloat(a[3]),new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([a[0],a[1]])),properties:{size:parseFloat(a[2]),color:isNaN(a[3])?a[3]:parseFloat(a[3])}})});function c(a,m,x){let b=a.filter(v=>isFinite(v[m]));return Math[x].apply(null,b.map(v=>v[m]))}e.sizeMin=c(i,2,"min"),e.sizeAvg/=s.length,e.sizeMax=c(i,2,"max"),e.colorMin=c(i,3,"min"),e.colorAvg/=s.length,e.colorMax=c(i,3,"max"),e.colorBins=[];let f=e.style.range.length;for(var l=1;l<f;l++)l<f/2&&e.colorBins.push(e.colorMin+(e.colorAvg-e.colorMin)/(f/2)*l),l===f/2&&e.colorBins.push(e.colorAvg),l>f/2&&e.colorBins.push(e.colorAvg+(e.colorMax-e.colorAvg)/(f/2)*(l-f/2));e.L.setSource(new ol.source.Vector({useSpatialIndex:!1,features:s})),e.style.legend?.dispatchEvent(new Event("update"))},e.xhr.send()}e.L=new ol.layer.Vector({zIndex:e.style.zIndex||1,style:o=>{let n=o.getProperties().properties,r=n.size<=e.sizeAvg?7+7/e.sizeAvg*n.size:14+7/(e.sizeMax-e.sizeAvg)*(n.size-e.sizeAvg);if(n.hxcolor=e.style.hxcolor||"#C0C0C0",parseFloat(n.color)){n.hxcolor=e.style.range[0];for(let i=0;i<e.colorBins.length&&!(n.color<e.colorBins[i]);i++)n.hxcolor=e.style.range[i+1]}return mapp.utils.style({icon:{type:"dot",fillColor:n.hxcolor,scale:r/30}})}}),e.mapview.Map.getTargetElement().addEventListener("changeEnd",t)};var pe,ut=async e=>{pe||(pe=new Promise(async r=>{await new google.maps.plugins.loader.Loader({apiKey:e.apiKey,version:"weekly"}).load(),r()})),await pe;let t=mapp.utils.html.node`
    <div style="position: absolute; width: 100%; height: 100%; transition: opacity .25s ease-in-out;">`;e.gmap=new google.maps.Map(t,{disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1});let o,n;e.L=new ol.layer.Layer({zIndex:0,render:r=>{if(!!e.display){n!==r.viewState.zoom&&(t.style.opacity=0),n=r.viewState.zoom;var i=ol.proj.toLonLat(r.viewState.center);return e.gmap.setCenter({lat:i[1],lng:i[0]}),e.gmap.setZoom(r.viewState.zoom),o&&clearTimeout(o),o=setTimeout(()=>{t.style.opacity=1},400),t}}})};var ue={mbtiles:rt,mapboxgl:it,tiles:st,mvt:lt,cluster:at,geojson:ct,grid:pt,googlemaps:ut};var dt=async e=>(ue[e.format]&&await ue[e.format](e),Object.assign(e,{show:Bo,showCallbacks:[],hide:Zo,hideCallbacks:[],tableCurrent:Ro,tableMax:Uo,tableMin:Do,zoomToExtent:Ho}),e.filter=Object.assign({current:{}},e.filter),e.style.opacity&&e.L.setOpacity(e.style.opacity),e.style&&e.style.themes&&(e.style.theme=e.style.theme||e.style.themes[Object.keys(e.style.themes)[0]]),Object.keys(e).forEach(t=>{mapp.layer[t]&&mapp.layer[t](e),mapp.plugins[t]&&mapp.plugins[t](e)}),e);function Bo(){this.display=!0,this.mapview.Map.removeLayer(this.L),this.mapview.Map.addLayer(this.L),typeof this.reload=="function"&&this.reload(),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.push("layers",this.key),this.showCallbacks?.forEach(e=>typeof e=="function"&&e(this))}function Zo(){this.display=!1,this.mapview.Map.removeLayer(this.L),this.mapview.attribution?.check(),this.mapview.hooks&&mapp.hooks.filter("layers",this.key),this.hideCallbacks?.forEach(e=>typeof e=="function"&&e(this))}function Ro(){if(!this.tables)return this.table;let e,t=parseInt(this.mapview.Map.getView().getZoom()),o=Object.keys(this.tables),n=parseInt(o[0]),r=parseInt(o[o.length-1]);return e=this.tables[t],e=t<n?this.tables[n]:e,e=t>r?this.tables[r]:e,e}function Uo(){return this.tables?Object.values(this.tables).reverse().find(e=>!!e):this.table}function Do(){return this.tables?Object.values(this.tables).find(e=>!!e):this.table}async function Ho(e){let t=await mapp.utils.xhr(`${this.mapview.host}/api/query/layer_extent?`+mapp.utils.paramString({dbs:this.dbs,locale:this.mapview.locale.key,layer:this.key,table:this.table||Object.values(this.tables)[0]||Object.values(this.tables)[1],geom:this.geom,proj:this.srid,srid:this.mapview.srid,filter:this.filter.current}));if(!t)return!1;let o=/\((.*?)\)/.exec(t.box2d)[1].replace(/ /g,",");return this.mapview.fitView(o.split(",").map(n=>parseFloat(n)),e),!0}var ft=e=>{e.hover.show=t=>{if(!e.mapview.interaction.current)return;let o=e.mapview.interaction.current.key.toString(),n=mapp.utils.paramString({dbs:e.dbs,locale:e.mapview.locale.key,layer:e.key,filter:e.filter?.current,template:e.hover.query||"infotip",qID:e.qID,id:e.highlight,table:e.tableCurrent(),geom:e.geom,field:e.hover.field,coords:e.format==="cluster"&&ol.proj.transform(t.getGeometry().getCoordinates(),`EPSG:${e.mapview.srid}`,`EPSG:${e.srid}`)});mapp.utils.xhr(`${e.mapview.host}/api/query?${n}`).then(r=>{e.mapview.interaction?.current?.key===o&&(!e.mapview.position||!r||r.label!=""&&e.mapview.infotip(r.label))})}};var mt={ni:Wo};function ht(e,t){return Object.keys(e).some(o=>{let n=Object.keys(e[o])[0];return mt[n]&&mt[n](o,e[o][n],t)})}function Wo(e,t,o){return new Set(t).has(o.properties[e])}var gt=e=>t=>{if(t.properties=t.getProperties(),t.properties.properties&&(Object.assign(t.properties,t.properties.properties),delete t.properties.properties),(e.style.filter||e.style.theme?.filter)&&e.filter.current&&Object.keys(e.filter.current).length&&mapp.layer.featureFilter(e.filter.current,t))return null;if(e.type==="cluster"&&(t.properties.count=t.get("features").length),e.featureLookup){let n=e.featureLookup.find(r=>r[e.featureLookupId||"id"]===t.properties.id);if(!n)return;Object.assign(t.properties,n)}t.style=Object.assign({},e.style.default,t.properties.count&&t.properties.count>1&&e.style.cluster||{},e.style.theme?.style||{}),t.geometryType=t.getGeometry().getType(),t.geometryType==="Point"?(t.style.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),t.style.icon=Object.assign({},t.style.icon||mapp.utils.clone(t.style))):delete t.style.icon,delete t.style.scale,delete t.style.clusterScale,mapp.layer.themes[e.style.theme?.type]&&mapp.layer.themes[e.style.theme.type](e.style.theme,t),t.style.icon?.clusterScale&&(t.style.icon.clusterScale=e.style.logScale?Math.log(t.style.icon.clusterScale)/Math.log(e.max_size)*Math.log(t.properties.size||t.properties.count):1+t.style.icon.clusterScale/e.max_size*(t.properties.size||t.properties.count)),t.style.icon?.zoomInScale&&(t.style.icon.zoomInScale*=e.mapview.Map.getView().getZoom()),t.style.icon?.zoomOutScale&&(t.style.icon.zoomOutScale/=e.mapview.Map.getView().getZoom());let o=t.get("id")||t.getId();if(e.highlight&&e.highlight===o){let n=mapp.utils.clone(e.style.highlight);t.geometryType==="Point"?(n.icon=n.icon||n.marker||mapp.utils.clone(n),n.icon.highlightScale=n.icon.scale||1,delete n.icon.scale,delete n.scale):delete n.icon,mapp.utils.merge(t.style,n)}if(e.style.label?.display&&(mapp.utils.merge(t.style,{label:e.style.label}),t.style.label.text=t.style.label.count&&t.properties.count>1&&t.properties.count||void 0,typeof t.style.label.text>"u"&&(t.style.label.text=t.properties[t.style.label.field]),typeof t.style.label.text>"u"&&(t.style.label.text=t.properties.label),t.style.label?.minZoom>e.mapview.Map.getView().getZoom()&&delete t.style.label,t.style.label?.maxZoom<e.mapview.Map.getView().getZoom()&&delete t.style.label),!(e.mapview?.locations[`${e.key}!${t.properties.id}`]&&(e.style.selected&&mapp.utils.merge(t.style,e.style.selected,{zIndex:1/0}),e.style.selected===null)))return mapp.utils.style(t.style,t)};function wt(e,t){var o=t.properties.cat||t.properties[e.field],n=e.cat&&(e.cat[o]?.style||e.cat[o]);if(o&&typeof n>"u"){var r=Object.values(e.cat).filter(s=>Array.isArray(s.keys)).find(s=>s.keys.includes(o)),n=mapp.utils.clone(r?.style||r);n&&delete n.label}typeof n<"u"&&(n.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),n.icon=t.geometryType==="Point"&&mapp.utils.clone(n.icon||n),delete n.label,mapp.utils.merge(t.style,n))}function yt(e,t){if(e.lookup||(e.lookup={},e.boxes=[],e.index=0),e.lookup[t.properties[e.field]]){var s=e.lookup[t.properties[e.field]];mapp.utils.merge(t.style,s);return}let o={extent:t.getGeometry().getExtent()},n=e.boxes.filter(c=>!(o.extent[0]>c.extent[2]||o.extent[2]<c.extent[0]||o.extent[1]>c.extent[3]||o.extent[3]<c.extent[1]));e.boxes.push(o);let r=new Set(n.map(c=>c.themeIdx));e.index++,e.index===e.cat_arr.length&&(e.index=0);let i=!r.has(e.index)&&parseInt(e.index);if(i===!1){for(let c=0;c<e.cat_arr.length;c++)if(!r.has(c)){i=c;break}}i===!1&&(i=parseInt(e.index)),o.themeIdx=i;var s=e.cat_arr[i];e.lookup[t.properties[e.field]]=s,mapp.utils.merge(t.style,s)}function xt(e,t){var o=parseFloat(t.properties.cat||t.properties[e.field]);if(!isNaN(o)){for(let r=0;r<e.cat_arr.length&&!(o<parseFloat(e.cat_arr[r].value));r++){var n=mapp.utils.clone(e.cat_arr[r].style||e.cat_arr[r]);delete n.label}n&&(n.marker&&console.warn("style.marker will be removed in v4 release. please use style.icon"),n.icon=t.geometryType==="Point"&&mapp.utils.clone(n.icon||n),delete n.label,mapp.utils.merge(t.style,n))}}var bt={decorate:dt,hover:ft,featureFilter:ht,Style:gt,themes:{categorized:wt,distributed:yt,graduated:xt}};var vt=e=>(Object.assign(e,{flyTo:Xo,Layers:[],remove:Ko,removeCallbacks:[],trash:Qo,update:Jo,updateCallbacks:[]}),e);function Ko(){delete this.remove,this.layer.mapview.hooks&&mapp.hooks.filter("locations",this.hook),delete this.layer.mapview.locations[this.hook],this.view instanceof HTMLElement&&this.view.remove(),this.Layers?.forEach(e=>this.layer.mapview.Map.removeLayer(e)),this.layer.mapview.interaction.type!=="highlight"&&this.layer.mapview.interactions.highlight(),this.layer.format==="mvt"?this.layer.L.changed():this.layer.reload&&this.layer.reload(),this.removeCallbacks?.forEach(e=>typeof e=="function"&&e(this))}async function Jo(){let e={};if(this.infoj.filter(o=>typeof o.newValue<"u").forEach(o=>{o.type==="integer"&&(o.newValue=isNaN(parseInt(o.newValue))?null:o.newValue),o.type==="numeric"&&(o.newValue=isNaN(parseFloat(o.newValue))?null:o.newValue),Object.assign(e,{[o.field]:o.newValue})}),!Object.keys(e).length)return;await mapp.utils.xhr({method:"POST",url:`${this.layer.mapview.host}/api/location/update?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id}),body:JSON.stringify(e)});let t=this.infoj.filter(o=>typeof o.newValue<"u").filter(o=>o.dependents&&o.dependents.length).map(o=>o.dependents).flat();if(this.infoj.filter(o=>typeof o.newValue<"u").forEach(o=>{o.value=o.newValue,delete o.newValue}),t.length){let o=await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id,fields:[...new Set(t)].join()}));this.infoj.filter(n=>typeof o[n.field]<"u").forEach(n=>{n.value=o[n.field]})}this.layer.reload(),this.updateCallbacks?.forEach(o=>typeof o=="function"&&o(this))}function Xo(){let e=new ol.source.Vector;this.Layers.forEach(t=>{let o=t.getSource();typeof o.getFeatures=="function"&&e.addFeatures(o.getFeatures())}),this.layer.mapview.fitView(e.getExtent())}async function Qo(){!confirm(mapp.dictionary.confirm_delete)||(await mapp.utils.xhr(`${this.layer.mapview.host}/api/location/delete?`+mapp.utils.paramString({locale:this.layer.mapview.locale.key,layer:this.layer.key,table:this.table,id:this.id})),this.layer.reload(),this.remove())}async function St(e,t=e.layer.mapview.locations){if(!e.layer||!e.id||(e.hook=`${e.layer.key}!${e.id}`,e.layer.mapview.interaction?.locations?.has(e.hook)))return;if(e.layer.mapview.interaction?.locations?.add(e.hook),t[e.hook]){t[e.hook].remove(),delete t[e.hook],e.layer.mapview.interaction?.locations?.delete(e.hook);return}e.table=e.table||e.layer.table||Object.values(e.layer.tables).find(r=>!!r);let o=await mapp.utils.xhr(`${e.layer.mapview.host}/api/location/get?`+mapp.utils.paramString({locale:e.layer.mapview.locale.key,layer:e.layer.key,table:e.table,id:e.id}));if(!o){console.log("No data returned from location get request"),mapp.hooks.filter("locations",e.hook);return}let n=e.layer.infoj.map(r=>{let i=mapp.utils.clone(r);return Object.assign(i,{title:o[i.field+"_label"]||i.title,value:o[i.field],location:e}),i});return mapp.location.decorate(Object.assign(e,{infoj:n})),t[e.hook]=e,e.layer.mapview.interaction?.locations?.delete(e.hook),e.layer.mapview.hooks&&mapp.hooks.push("locations",e.hook),e}async function kt(e){let t=e.feature.getProperties(),o=e.feature.getGeometry(),n=o.getCoordinates(),r=ol.proj.transform(n,"EPSG:"+e.mapview.srid,"EPSG:"+e.layer.srid),i=await mapp.utils.xhr(`${e.mapview.host}/api/query/get_nnearest?`+mapp.utils.paramString({locale:e.mapview.locale.key,layer:e.layer.key,geom:e.layer.geom,qID:e.layer.qID,cluster_label:e.layer.cluster_label||e.layer.qID,table:e.table,filter:e.layer.filter?.current,n:t.count>(e.max||99)?e.max||99:t.count,x:r[0],y:r[1],coords:r})),s=mapp.utils.html.node`
    <div style="max-width: 66vw; max-height: 300px; overflow-x: hidden;">
      <ul>
      ${i.map(c=>mapp.utils.html.node`
        <li
          onclick=${f=>{e.mapview.popup(null),mapp.location.get({layer:e.layer,table:e.table,id:c.id,marker:ol.proj.transform(c.coords,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid)})}}>${c.label||'"'+e.layer.cluster_label+'"'}`)}`;e.mapview.popup({coords:ol.proj.transform(r,"EPSG:"+e.layer.srid,"EPSG:"+e.mapview.srid),content:s,autoPan:!0})}var Et={decorate:vt,get:St,nnearest:kt};async function Mt(e){if(!Array.isArray(e))return;let t=this.hooks&&mapp.hooks.current.layers.length;for(let o of e){let n=mapp.utils.clone(o);n.mapview=this,t&&(n.display=!!~mapp.hooks.current.layers.indexOf(n.key)),await mapp.layer.decorate(n),this.layers[n.key]=n,n.display&&n.show()}return e}function Ct(e,t={}){this.Map.getView().fit(e,Object.assign({padding:[50,50,50,50],duration:1e3},t))}function Lt(e){let t=this.Map.getView().calculateExtent();if(!e)return{south:t[1],west:t[0],north:t[3],east:t[2]};let o=ol.proj.transformExtent(t,`EPSG:${this.srid}`,`EPSG:${e}`);return{south:o[1],west:o[0],north:o[3],east:o[2]}}function jt(e){let t=new ol.format.GeoJSON,o=e.geometry&&t.readFeature({type:"Feature",geometry:e.geometry},{dataProjection:`EPSG:${e.dataProjection||this.srid}`,featureProjection:`EPSG:${this.srid}`}),n=new ol.source.Vector;o&&n.addFeature(o);let r=new ol.layer.Vector({source:n,zIndex:e.zIndex,style:e.Style});return this.Map.addLayer(r),r}var k={};function $t(e){let t=this;if(k.node?.remove(),t.Map.un("pointermove",o),!e)return;k.node=mapp.utils.html.node`<div class="infotip box-shadow">`,k.node.innerHTML=e,t.Map.getTargetElement().appendChild(k.node),t.Map.on("pointermove",o),o();function o(){k.node.style.opacity=1,k.node.style.left=t.pointerLocation.x-k.node.offsetWidth/2+"px",k.node.style.top=t.pointerLocation.y-k.node.offsetHeight-15+"px"}}function Ft(e){if(this._locate=this._locate||Object.assign({icon:{svg:`${this.host}/icons/locator.svg`,scale:.05},feature:new ol.Feature({geometry:new ol.geom.Point([0,0])})},e||{}),this._locate.active=!this._locate.active,this._locate.L||(this._locate.L=new ol.layer.Vector({source:new ol.source.Vector({features:[this._locate.feature]}),zIndex:999,style:mapp.utils.style({icon:this._locate.icon})})),!this._locate.active){this.Map.removeLayer(this._locate.L);return}this.Map.addLayer(this._locate.L),mapp.utils.getCurrentPosition(t=>{let o=ol.proj.fromLonLat([parseFloat(t.coords.longitude),parseFloat(t.coords.latitude)]);this._locate.feature.getGeometry().setCoordinates(o),this.Map.getView().animate({center:o,zoom:this.locale.maxZoom})})}var M={};function Ot(e){let t=this;M.node?.remove(),e&&(M.node=mapp.utils.html.node`<div class="popup box-shadow">`,M.node.appendChild(e.content),M.overlay&&t.Map.removeOverlay(M.overlay),M.overlay=new ol.Overlay({element:M.node,position:e.coords||t.position,positioning:"bottom-center",autoPan:e.autoPan,insertFirst:!0,autoPanAnimation:{duration:250}}),t.Map.addOverlay(M.overlay))}var u;function Pt(e){this.interaction?.finish(),u=Object.assign({mapview:this,type:"highlight",finish:f,clear:s,highlight:n,getLocation:c,hitTolerance:5,candidates:{},candidateKeys:new Set,locations:new Set,layerFilter:l=>Object.values(this.layers).some(a=>a.qID&&a.L===l)},e),u.mapview.interaction=u,u.mapview.Map.on("pointermove",o),u.mapview.Map.on("click",i);let t;function o(l){if(t)return;t=!0;let a={};if(u.mapview.Map.forEachFeatureAtPixel(l.pixel,(x,b)=>{let v={key:`${b.get("key")||ol.util.getUid(b)}!${x.get("id")||x.getId()||ol.util.getUid(x)}`,F:x,L:b};a[v.key]=v},{layerFilter:u.layerFilter,hitTolerance:u.hitTolerance}),!Object.keys(a).length){u.candidateKeys=new Set,t=!1,s();return}if(mapp.utils.areSetsEqual(u.candidateKeys,new Set(Object.keys(a)))){t=!1;return}let m=a[Object.keys(a).find(x=>!u.candidateKeys.has(x))];m=m||u.current?.key&&a[u.current?.key]||a[Object.keys(a)[0]],u.candidateKeys=new Set(Object.keys(a)),t=!1,u.highlight(m,l)}function n(l,a){if(s(),u.current=Object.assign(l,{layer:u.mapview.layers[l.L.get("key")],id:l.F.get("id")||l.F.getId()}),u.current.layer.highlight=l.id,a.originalEvent.pointerType!=="mouse"){a.type!=="pointermove"&&u.getLocation(u.current),s();return}u.current.layer.infoj&&(u.mapview.Map.getTargetElement().style.cursor="pointer"),typeof u.current.layer.hover?.show=="function"&&u.current.layer.hover.show(l.F),u.current.layer.format!=="mvt"&&typeof u.current.F.setStyle=="function"?(l.F.set("highlight",!0),u.current.F.setStyle()):u.current.layer.style.highlight&&u.current.layer.L.changed()}let r;function i(l){if(!r){if(r=setTimeout(()=>{r=null},600),l.originalEvent.pointerType==="touch"){u.candidateKeys=new Set,l.type="touchClick",o(l);return}if(u.mapview.popup(null),u.current){u.getLocation(u.current);return}typeof u.noLocationClick=="function"&&u.noLocationClick(l)}}function s(){!u.current||(u.mapview.infotip(null),u.mapview.Map.getTargetElement().style.cursor="auto",delete u.current.layer.highlight,u.current.layer.format!=="mvt"&&typeof u.current.F.setStyle=="function"?(u.current.F.set("highlight",!1),u.current.F.setStyle()):u.current.layer.style.highlight&&u.current.layer.L.changed(),delete u.current)}function c(l){if(!l.layer.infoj)return;if(l.F.getProperties().count>1){mapp.location.nnearest({mapview:u.mapview,layer:l.layer,table:l.layer.table||l.layer.tableCurrent(),feature:l.F});return}mapp.location.get({layer:l.layer,table:l.layer.table||l.layer.tableCurrent(),id:l.layer.highlight})}function f(){u.mapview.interaction=null,s(),u.mapview.popup(null),u.mapview.Map.un("pointermove",o),u.mapview.Map.un("click",i)}}var p;function Tt(e){this.interaction?.finish(),this.interaction?.finish(),p=Object.assign({mapview:this,type:"draw",finish:o,getFeature:t,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector,contextMenu:mapp.ui?.elements.contextMenu.draw.bind(this),vertices:[],condition:n=>{if(n.originalEvent.buttons===2){p.interaction.removeLastPoint(),p.vertices.pop();let r=new ol.MapBrowserEvent("pointermove",p.mapview.Map,n.originalEvent);return p.interaction.handleEvent(r),p.interaction.handleEvent(r),!1}if(n.originalEvent.buttons===1)return p.vertices.push(n.coordinate),p.mapview.popup(null),p.conditions?.forEach(r=>typeof r=="function"&&r(n)),!0},style:[new ol.style.Style({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})]},e),p.mapview.interaction=p,p.mapview.Map.getTargetElement().style.cursor="crosshair",p.Layer.setSource(p.source),p.mapview.Map.addLayer(p.Layer),p.interaction=new ol.interaction.Draw(p),p.interaction.on("drawstart",n=>{let r=n.feature.getGeometry();async function i(){p.mapview.popup({content:mapp.utils.html.node`
          <div style="padding: 5px">${await mapp.utils.convert(p.mapview.metrics[p.tooltip.metric](r),p.tooltip)}`})}p.tooltip&&r.on("change",p.tooltip.onChange||i),p.source.clear(),p.mapview.popup(null)}),p.interaction.on("drawend",()=>{if(typeof p.drawend=="function"){p.drawend();return}typeof p.contextMenu=="function"&&p.contextMenu()}),p.mapview.Map.addInteraction(p.interaction),p.snap&&p.mapview.interactions.snap(p);function t(){return JSON.parse(p.format.writeFeature(p.source.getFeatures()[0],{dataProjection:"EPSG:"+p.srid||p.mapview.srid,featureProjection:"EPSG:"+p.mapview.srid}))}function o(n){p.mapview.interaction=null,p.mapview.Map.getTargetElement().style.cursor="default",p.snap&&p.mapview.interactions.snap(null),typeof p.callback=="function"&&p.callback(n),p.mapview.popup(null),p.mapview.Map.removeInteraction(p.interaction),p.mapview.Map.removeLayer(p.Layer)}}var d;function zt(e){this.interaction?.finish(),this.interaction?.finish(),d=Object.assign({mapview:this,type:"modify",finish:o,format:new ol.format.GeoJSON,source:new ol.source.Vector,Layer:new ol.layer.Vector({zIndex:1/0}),vertices:[],contextMenu:mapp.ui?.elements.contextMenu.modify.bind(this),getFeature:t,Style:[new ol.style.Style({image:new ol.style.Circle({stroke:new ol.style.Stroke({color:"#3399CC",width:1.25}),radius:5}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"#eee"}),stroke:new ol.style.Stroke({color:"#3399CC",width:1.25})}),geometry:mapp.utils.verticeGeoms})],deleteCondition:n=>{if(n.type==="singleclick"){let r=d.Feature.getGeometry(),i=r.getType();if(i==="Point")return;let s=r.getCoordinates();if(i==="LineString"&&s.length<3||s[0].length<=4)return;d.mapview.popup({coords:d.Feature.getGeometry().getClosestPoint(n.coordinate),content:mapp.utils.html.node`<ul>
            <li
              onclick=${()=>{d.interaction.removePoint(),d.vertices.push(d.Feature.getGeometry().getClosestPoint(n.coordinate))}}>${mapp.dictionary.delete_vertex}`})}}},e),d.mapview.interaction=d,d.mapview.Map.getTargetElement().style.cursor="crosshair",d.Feature&&d.source.addFeature(d.Feature),d.Layer.setSource(d.source),d.Layer.setStyle(d.Style),d.mapview.Map.addLayer(d.Layer),d.interaction=new ol.interaction.Modify(d),d.interaction.on("modifystart",n=>{d.mapview.popup(null)}),d.interaction.on("modifyend",n=>{if(d.vertices.push(n.mapBrowserEvent.coordinate),d.modifyend)return d.modifyend(n,modify);typeof d.contextMenu=="function"&&setTimeout(d.contextMenu,400)}),d.mapview.Map.addInteraction(d.interaction),d.snap&&d.mapview.interactions.snap(d);function t(){return JSON.parse(d.format.writeFeature(d.Feature,{dataProjection:"EPSG:"+d.srid||d.mapview.srid,featureProjection:"EPSG:"+d.mapview.srid}))}function o(n){d.mapview.interaction=null,d.mapview.Map.getTargetElement().style.cursor="default",d.snap&&d.mapview.interactions.snap(null),typeof d.callback=="function"&&d.callback(n),d.mapview.popup(null),d.mapview.Map.removeInteraction(d.interaction),d.mapview.Map.removeLayer(d.Layer)}}function It(e){let t=this;t.interaction?.finish();let o={finish:n,Layer:new ol.layer.Vector({source:new ol.source.Vector})};t.interaction=o,o.callback=e.callback,o.Layer.getSource().clear(),t.Map.addLayer(o.Layer),t.Map.getTargetElement().style.cursor="zoom-in",o.interaction=new ol.interaction.Draw({source:o.Layer.getSource(),type:"Circle",geometryFunction:ol.interaction.Draw.createBox(),style:new ol.style.Style({stroke:new ol.style.Stroke({color:"#ddd",width:1}),fill:new ol.style.Stroke({color:"#fff9"})})}),o.interaction.on("drawend",r=>{t.fitView(r.feature.getGeometry().getExtent()),n()}),t.Map.addInteraction(o.interaction);function n(){delete t.interaction,o.callback&&(o.callback(),delete o.callback),t.Map.getTargetElement().style.cursor="auto",t.Map.removeInteraction(o.interaction),t.Map.removeLayer(o.Layer),o.Layer.getSource().clear()}}var w;function Gt(e){if(e===null){w.mapview.Map.removeInteraction(w.snap.interaction),w.layer.snapSource?.un("tileloadend",At),w.mapview.Map.removeLayer(w.snap.vectorTileLayer);return}w=Object.assign(e,{snap:{source:new ol.source.Vector}}),w.layer.snapSource?(w.layer.snapSource.on("tileloadend",At),w.snap.vectorTileLayer=new ol.layer.VectorTile({source:w.layer.snapSource,opacity:0}),w.mapview.Map.addLayer(w.snap.vectorTileLayer),w.layer.snapSource.refresh()):w.snap.source=w.layer.L.getSource(),w.snap.interaction=new ol.interaction.Snap({source:w.snap.source}),w.mapview.Map.addInteraction(w.snap.interaction)}function At(e){w.snap.source.addFeatures(e.tile.getFeatures())}var _t=e=>{Object.assign(e,{srid:e.locale.srid||"3857",addLayer:Mt,fitView:Ct,geoJSON:jt,getBounds:Lt,infotip:$t,locate:Ft,metrics:{distance:i=>ol.sphere.getLength(new ol.geom.LineString([i.getInteriorPoint().getCoordinates(),e.position])),area:i=>ol.sphere.getArea(i),length:i=>ol.sphere.getLength(i)},popup:Ot,layers:{},locations:{},interactions:{highlight:Pt.bind(e),draw:Tt.bind(e),modify:zt.bind(e),zoom:It.bind(e),snap:Gt}});let t=mapp.hooks?.current?.z||e.locale.view?.z||e.locale.minZoom||0,o=ol.proj.fromLonLat([parseFloat(mapp.hooks?.current?.lng||e.locale.view?.lng||0),parseFloat(mapp.hooks?.current?.lat||e.locale.view?.lat||0)]);e.locale.bounds&&console.warn("locale.bounds have been renamed to locale.extent");let n=e.locale.extent&&ol.proj.transformExtent([parseFloat(e.locale.extent.west||-180),parseFloat(e.locale.extent.south||-90),parseFloat(e.locale.extent.east||180),parseFloat(e.locale.extent.north||90)],"EPSG:4326",`EPSG:${e.srid}`);if(e.Map=new ol.Map({target:e.target,interactions:ol.interaction.defaults.defaults({mouseWheelZoom:e.scrollWheelZoom||!1,pinchRotate:e.pinchRotate&&{threshold:3}||!1}),moveTolerance:5,controls:e.controls||[],view:new ol.View({projection:`EPSG:${e.srid}`,zoom:t,minZoom:e.locale.minZoom,maxZoom:e.locale.maxZoom,center:o,extent:n})}),e.locale.maskBounds&&console.warn("locale.maskBounds is set as mask:true in locale.extent"),e.locale.extent?.mask){let i=[[180,90],[180,-90],[-180,-90],[-180,90],[180,90]],s=[[e.locale.extent.east,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.south],[e.locale.extent.west,e.locale.extent.north],[e.locale.extent.east,e.locale.extent.north]],c=new ol.Feature({geometry:new ol.geom.Polygon([i,s]).transform("EPSG:4326",`EPSG:${e.srid}`)});e.Map.addLayer(new ol.layer.Vector({source:new ol.source.Vector({features:[c]}),style:new ol.style.Style({fill:new ol.style.Fill({color:"#00000044"})}),zIndex:1/0}))}e.scalebar&&e.Map.addControl(new ol.control.ScaleLine({units:e.scalebar})),e.attribution&&(typeof e.attribution!="object"&&(e.attribution={}),e.attribution.target=e.attribution.target||e.Map.getTargetElement().appendChild(mapp.utils.html.node`
          <div class="attribution-links">`),e.attribution.check=()=>{let i=Object.assign({},e.attribution.links||{});Object.values(e.layers).forEach(s=>{s.display&&s.attribution&&Object.assign(i,s.attribution)}),mapp.utils.render(e.attribution.target,mapp.utils.html`${Object.entries(i).map(s=>mapp.utils.html`
              <a target="_blank" href="${s[1]}">${s[0]}`)}`)}),e.Map.on("pointermove",i=>{e.position=i.coordinate,e.pointerLocation={x:i.originalEvent.clientX,y:i.originalEvent.clientY}}),e.Map.getTargetElement().addEventListener("mouseout",()=>{e.infotip(null),e.position=null,e.pointerLocation={x:null,y:null}}),e.Map.getTargetElement().addEventListener("changeEnd",()=>{if(!e.hooks)return;let i=ol.proj.transform(e.Map.getView().getCenter(),`EPSG:${e.srid}`,"EPSG:4326");mapp.hooks.set({lat:Math.round((i[1]+Number.EPSILON)*1e5)/1e5,lng:Math.round((i[0]+Number.EPSILON)*1e5)/1e5,z:Math.round((e.Map.getView().getZoom()+Number.EPSILON)*100)/100})});let r;return e.Map.on("moveend",()=>{clearTimeout(r),r=setTimeout(()=>{e.Map.getTargetElement().dispatchEvent(new CustomEvent("changeEnd"))},500)}),e};self.mapp=function(e){return V.parse(),Object.assign(e,{version:"4.0.0",hash:"ee17e646dd0867fb10a93d2f3c2df9569031fba1",language:V.current.language||"en",dictionaries:nt,dictionary:new Proxy({},{get:function(t,o,n){return e.dictionaries[e.language][o]?e.dictionaries[e.language][o]:e.dictionaries.en[o]}}),hooks:V,layer:bt,location:Et,Mapview:_t,plugins:{},utils:We}),e}({});})();
/*! (c) Andrea Giammarchi - ISC */
//# sourceMappingURL=mapp.js.map
